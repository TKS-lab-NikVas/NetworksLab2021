# NetworksLab2021 (Роман Васильев, Никифоров Тимофей)

## Лабораторная работа № 3

В рамках данной лабораторной работы была реализована служба обмена позитивным контентом. Проект можно разделить на две
части (клиентскую и серверную). Расскажем об общих концепциях, принятых для всего проекта при выполнении поставленной
задачи.

### Общие детали реализации

Для обмена сообщениями было необходимо согласовать формат, в котором сообщения будут поступать на сервер и возвращаться
нужным клиентам. Типовое сообщение имеет вид:
`'{'parcelType':'%PARCEL_TYPE%', 'message':'%MESSAGE%', 'username':'%USERNAME%', 'attachmentType':'%ATTACHMENT_TYPE%','attachmentName':'%ATTACHMENT_NAME%', 'attachmentSize':'%ATTACHMENT_SIZE%'}'`
, где `parcelType` - тип сообщения, `message` - текст сообщения, `username` - имя пользователя, отправившего
сообщение, `attachmentType` - тип вложенного файла, `attachmentName` - имя вложенного файла, `attachmentSize` - размер
вложенного файла. Если клиент отправляет файл, то он отправляется в виде последовательности байт следом за приведенным
выше сообщением. Клиент обрабатывает сообщения от клиентов и организовывает рассылку всем подключенным клиентам рассылку
в соответствии с типом полученного сообщения.

Далее рассмотрим типичный пример работы чата:

1. Сервер начинает работу.
2. Клиент подключается по ip-адресу сервера и порту 6666, отправляя своё имя пользователя. Если это имя пользователя уже
   занято, сервер отправляет пользователю сообщение об ошибке типа "Имя пользователя уже занято" (код 1). В противном
   случае подключенному пользователю присваивается введенное имя пользователя, а остальные клиенты получают сообщение о
   подключении нового пользователя.
3. Клиент отправляет на сервер сообщение. Сообщение может не содержать вложенный файл, в этом случае поля сообщения
   `attachmentType` и `attachmentName` будут пустыми, а в поле `attachmentSize` будет передан 0. Если клиент отправляет
   файл, то указанные ранее поля заполняются в соответствии с приложенным файлом.
4. Сервер получает сообщение от пользователя, отправляет полученное сообщение всем клиентам в чате, добавляя поле
   времени, состоящее из часов, минут и секунд.
5. Клиенты получают сообщение от сервера и отображают полученные данные в соответствии с типом сообщения.
6. При вводе пользователем `!exit` в поле Message происходит отключение данного клиента, серверу поступает сообщение об
   отключении клиента, сервер оповещает остальных участников чата об отключении клиента.

Приведем основные типы сообщений (`parcelType`):

* greeting - тип сообщений, отправляемый клиентом при подключении к серверу и сервером при успешном подключении клиента;
* message - тип сообщений, отправляемый клиентом при отправке обычного сообщения и сервером после успешной обработки
  сообщения;
* exception - тип сообщений, отправляемый сервером при наличии ошибок во время работы. На данный момент реализован один
  вид исключений, о которых сервер уведомляет клиента - "Имя пользователя уже занято" - отправляемое с указанием кода
  ошибки (1) в поле `message`;
* exit - тип сообщений, отправляемый клиентом при отключении от сервера и сервером после отключения клиента.
